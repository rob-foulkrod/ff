---
interface Standing {
  rank: number;
  team: string;
  wins: number;
  losses: number;
  points: number;
  winPercentage: number;
}

interface Props {
  standings: Standing[];
}

const { standings } = Astro.props;

// Add visual indicators
const getRecordClass = (wins, losses) => {
  const winPct = wins / (wins + losses);
  if (winPct >= 0.7) return 'elite';
  if (winPct >= 0.5) return 'good';
  return 'struggling';
};

const getTrendIcon = () => {
  // This would check previous week
  return 'â†‘'; // or â†“ or â†’
};
---

<div class="fff-standings-wrapper">
  <div class="text-center text-sm text-gray-600 dark:text-gray-400 mb-4">
    <strong>Note:</strong> The league's only official divisions are <strong>Kids Table 1985</strong> and <strong>Kids Table 2010</strong>.<br />
  </div>
  <table class="fff-standings-table">
    <thead>
      <tr>
        <th>Rank</th>
        <th>Team</th>
        <th>Record</th>
        <th>PF</th>
        <th>PA</th>
        <th>Streak</th>
        <th>Trend</th>
      </tr>
    </thead>
    <tbody>
      {standings.map((team, index) => (
        <tr class={`fff-team-row ${index === 0 ? 'leader' : ''} ${index < 6 ? 'playoff' : ''}`}>
          <td class="rank">
            {index === 0 && <span class="crown">ðŸ‘‘</span>}
            {index + 1}
          </td>
          <td class="team-name">
            <div class="team-info">
              <span class="team-avatar">{team.team.charAt(0)}</span>
              <span>{team.team}</span>
            </div>
          </td>
          <td class={`record ${getRecordClass(team.wins, team.losses)} numeric`}>
            <span class="wins">{team.wins}</span>
            <span class="separator">-</span>
            <span class="losses">{team.losses}</span>
          </td>
          <td class="points-for numeric">{typeof team.pointsFor === 'number' ? team.pointsFor.toFixed(1) : 'â€”'}</td>
          <td class="points-against numeric">{typeof team.pointsAgainst === 'number' ? team.pointsAgainst.toFixed(1) : 'â€”'}</td>
          <td class="streak">
            <span class="fff-streak-badge" role="status" aria-label={`Current streak ${team.current_streak || 'unknown'}`}>
              {/* show the raw streak string when available (W6 / L2) */}
              {team.current_streak || 'â€”'}
            </span>
          </td>
          <td class="trend">
            {/* trend: include visual glyph and hidden text for screen readers */}
            <span class={`fff-trend ${team.trend === 'down' ? 'fff-trend-down' : 'fff-trend-up'}`}>
              <span aria-hidden="true">{team.trend === 'down' ? 'â†“' : 'â†‘'}</span>
              <span class="visually-hidden">Trend: {team.trend === 'down' ? 'falling' : 'rising'}</span>
            </span>
          </td>
        </tr>
      ))}
    </tbody>
  </table>
</div>

<style>
  .fff-standings-wrapper {
    overflow-x: auto;
    border-radius: 0.75rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  }

  .fff-standings-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
  }

  /* Ensure body cells are readable in dark mode by providing explicit foreground
     color fallbacks and a dark table background when the site is in .dark mode. */
  .fff-standings-table td {
    color: var(--fff-text, #111);
  }

  /* Dark mode: make the table background dark and body text light for contrast */
  html.dark .fff-standings-table {
    background: var(--fff-surface-dark, #0b0b0b);
  }

  html.dark .fff-standings-table td {
    color: var(--fff-text, #e6e6e6);
  }

  /* Make PF/PA numbers bolder and brighter in dark mode */
  html.dark .points-for,
  html.dark .points-against {
    color: var(--fff-cream, #f7e7c6);
    font-weight: 700;
  }

  /* Dark mode: make win-loss records (e.g. "10-5") stand out and be easier to read */
  html.dark .fff-standings-table .record {
    color: var(--fff-text, #f5f5f5);
    font-weight: 800;
    text-shadow: 0 1px 0 rgba(0,0,0,0.6);
    background: rgba(255,255,255,0.02);
    padding: 0.125rem 0.4rem;
    border-radius: 0.35rem;
    display: inline-block;
    min-width: 3.25rem;
    text-align: center;
  }

  /* Slightly dim the separator hyphen so numbers read as pairs but separator doesn't overpower */
  html.dark .fff-standings-table .record .separator {
    color: rgba(230,230,230,0.6);
    margin: 0 0.25rem;
    font-weight: 600;
  }

  /* Make wins/losses numbers use the cream accent so they pop in dark mode */
  html.dark .fff-standings-table .record .wins,
  html.dark .fff-standings-table .record .losses {
    color: var(--fff-cream, #f7e7c6);
    font-weight: 800;
  }

  .fff-standings-table thead {
    background: var(--fff-black);
    color: white;
  }

  .fff-standings-table th {
    padding: 1rem;
    text-align: left;
    font-weight: 700;
    text-transform: uppercase;
    font-size: 0.875rem;
    letter-spacing: 0.05em;
  }

  .fff-team-row {
    border-bottom: 1px solid var(--fff-cream-dark);
    transition: background 0.2s;
  }

  .fff-team-row:hover {
    background: var(--fff-cream);
  }

  .fff-team-row.leader {
    background: var(--fff-table-row-hover);
  }

  .fff-team-row.playoff {
    border-left: 4px solid var(--fff-gold);
  }

  .fff-team-row td {
    padding: 1rem;
  }

  .team-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-weight: 600;
  }

  .team-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--fff-crimson);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
  }

  .record {
    font-weight: 700;
    font-size: 1.125rem;
  }

  .record.elite .wins { color: var(--fff-gold); }
  .record.good .wins { color: var(--fff-black); }
  .record.struggling .losses { color: var(--fff-crimson); }
  /* streak and trend visuals moved to the global theme (site/public/styles/foulknfootball-theme.css) for Foulk â€™n Football
     component now uses .fff-streak-badge and .fff-trend classes */

  .crown {
    margin-right: 0.25rem;
  }

  @media (max-width: 768px) {
    .fff-standings-table {
      font-size: 0.875rem;
    }

    .fff-standings-table th,
    .fff-standings-table td {
      padding: 0.5rem;
    }

    .team-avatar {
      width: 24px;
      height: 24px;
      font-size: 0.75rem;
    }
  }
</style>
